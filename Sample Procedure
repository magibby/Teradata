REPLACE PROCEDURE Sales_Dept_Grant ( )
BEGIN
Declare GrantStmt VARCHAR(77) Default '';
For UserList as UserList CURSOR FOR
Select User_Name, Admin_Ind From Sales_Dept_Users
Do
CASE UserList.Admin_Ind
WHEN 0 Then
Set GrantStmt = 'GRANT SELECT on Sales_Dept to ' || UserList.User_Name;
ELSE
Set GrantStmt = 'GRANT ALL on Sales_Dept to ' || UserList.User_Name || '
With Grant Option';
END CASE;
CALL DBC.SysExecSql( :GrantStmt );
END For;
END;


CT Sales_Dept (Acct varchar(44), Sale_Date DATE, Gross DEC(18,2), Net DEC(18,2);
insert into Sales_Dept values ('Acme Bearings','2013-02-13',12345.00,1234.50)
;insert into Sales_Dept values ('Horse Hockey','2013-03-23',57890.00,5789.00)
;insert into Sales_Dept values ('My Jaxx','2013-04-02',678930.00,67893.00)
CT Sales_Dept_Users (User_Name varchar(32), Admin_Ind BYTEINT);
insert into Sales_Dept_Users values ('GC151000',1)
;insert into Sales_Dept_Users values ('dulles',0)


DECLAREcalc_cursor CURSOR FOR
SELECT AccountType, AccountNumber, (OpeningBalance+AccruedInterest) AS BaseAmount FROM Savings
WHERE(AccountType= :Arg_AccontType
OR 'A '= :Arg_AccontType)
AND LastAccrualDate< DATE;


--another procedure with for loop example 

REPLACE PROCEDURE FINANCIAL.INSERT_ALL_NEW (IN OLD_MODEL_ID INTEGER, IN SEQ_NO INTEGER)

BEGIN

DECLARE L_IN_MODEL_ID INTEGER;
DECLARE L_SEQ_NO INTEGER;
DECLARE L_DUP_COUNT INTEGER;


SET L_IN_MODEL_ID = OLD_MODEL_ID;
SET L_SEQ_NO = SEQ_NO;

BEGIN

FOR NEWMDLCUR AS NEWCUR CURSOR FOR
SELECT Y.NEW_MODEL_ID FROM FINANCIAL.REPLACEMENTS Y
WHERE Y.OLD_MODEL_ID = L_IN_MODEL_ID
AND Y.NEW_MODEL_ID NOT IN (SELECT Z.NEW_MODEL_ID FROM FINANCIAL.MODEL_GRP Z WHERE Z.OLD_MODEL_ID = L_IN_MODEL_ID)

DO

BEGIN

SET L_DUP_COUNT = 0;

SELECT COUNT(1) 
INTO L_DUP_COUNT FROM
FINANCIAL.MODEL_GRP
WHERE GROUP_ID = L_SEQ_NO
AND OLD_MODEL_ID = L_IN_MODEL_ID
AND NEW_MODEL_ID = NEWMDLCUR.NEW_MODEL_ID;


IF (L_DUP_COUNT = 0) THEN

INSERT INTO FINANCIAL.MODEL_GRP VALUES (L_SEQ_NO, L_IN_MODEL_ID, NEWMDLCUR.NEW_MODEL_ID);

--CALLING THE PROCEDURE TO INSERT ALL THE OLD MODEL LIST

CALL FINANCIAL.INSERT_ALL_NEW(NEWMDLCUR.NEW_MODEL_ID,L_SEQ_NO);

--NOW CALLINF THE PROCEDURE TO INSERT ALL THE NEW MODEL LIST

CALL FINANCIAL.INSERT_ALL_OLD(NEWMDLCUR.NEW_MODEL_ID,L_SEQ_NO);

END IF;

END;

END FOR;

END ; --MAIN BLOCK

END;
